# Pretraining
## collecting export data
1. Run `roslaunch arena_bringup start_arena_flatland_waypoint.launch local_planner:=None train_mode:=true` to disable local planner and use plan manager to sample and get subgoal based on the global path generated by the global planner. The lookahead_distance param in the plan magager will automatically set properly.
2. Go the directory *arena_navigation/arena_local_planner/learning_based/arena_local_planner_drl/scripts/training* and run `python pretrainig_wp_single_env -p1`
3. add params `-p2` to enable pretraining and save trained model.
# Training
1. Run `roslaunch arena_bringup start_training_waypoint.launch`.Some important arguments are:
   * *ns_prefix* set it if you want running multiple training scripts in parallel. This is the key point to isolate the training environments.
   * *num_envs* number of the training environments and one of them will be used for evaluation.
   * *local_planner* could be *teb*
2. Go the directory *arena_navigation/arena_local_planner/learning_based/arena_local_planner_drl/scripts/training* and run `python train_agent_wp.py`, the default setting located in the following directory *arena_navigation/arena_local_planner/learning_based/arena_local_planner_drl/rl_agent/config/defaultsWP2.py*. To overwrite the default setting, you can append the parameters in the command line, an example would be `python train_agent_wp.py NET_ARCH.FEATURE_EXTRACTOR.NAME Pure_Dyn_Obs` which changes the feature extractor. There are some others features such as loading pretrained model, you can check the usage using '-h' argument. 
# Evaluation and deployment
1. In the 1st terminal run the command `roslaunch arena_bringup start_arena_flatland_waypoint.launcroslaunch arena_bringup start_arena_flatland_waypoint.launchh`, remember to set `map_file:=???`
2. Go the directory *arena_navigation/arena_local_planner/learning_based/arena_local_planner_drl/scripts/training* and run `python train_agent_wp.py --conf_file=/home/joe/ssd/projects/arena-rosnav-ws/src/arena-rosnav/arena_navigation/arena_local_planner/learning_based/arena_local_planner_drl/output/CNN_Laser_MLP_Goal_Dyn_Obs_2021_08_26_16_18_09/Hyperparams.yaml","--deploy"]`