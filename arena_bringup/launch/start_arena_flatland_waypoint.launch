<launch>
    
  <param name="use_sim_time" value="true"/>
  
  <!-- <arg name="local_planner"   default="rlca"/> -->
  <!-- local_planner could be "None", this is useful to collect data for pretraining -->
  <arg name="local_planner" default="drl"/> 
  <arg name="rviz_file"       default="vtwg_deploy"/>
  <arg name="train_mode"      default="false"/>
  <!-- drl or teb -->
  <param name="train_mode"    value="$(arg train_mode)"/>

  <arg name="step_size" default="0.05"/>
  <arg name="update_rate" default="50"/>
  <arg name="show_viz"  default="true"/>


  <param name="update_rate" value="$(arg update_rate)" />
  <param name="step_size" value="$(arg step_size)" /> 
  <param name="show_viz" value="$(arg show_viz)"/>
  <!-- Map parameters -->

  <!-- <arg name="map_file"        default="map_empty"/> -->
  <arg name="map_file"        default="map1"/>
  <arg name="map_path"        default="$(find simulator_setup)/maps/$(arg map_file)/map.yaml"/>
  <arg name="world_path"      default="$(find simulator_setup)/maps/$(arg map_file)/map.world.yaml"/>
  <param name="world_path"  value="$(arg world_path)" />
  <arg name="global_frame_id"   value="map"/>
  <arg name="odom_frame_id"     value="odom"/>
  <arg name="base_frame_id"     value="base_footprint"/>
  
  <arg name="odom_ground_truth" default="/odometry/ground_truth"/>

  <!-- Visualization -->
  <arg name="use_viz"         default="true"/>
  <param name="use_viz"       value="$(arg use_viz)"/>

  <!-- Obstacle parameters -->
  <arg name="obs_vel"       default="0.3"/>
  <param name="obs_vel"     value="$(arg obs_vel)"/>
  <param name="robot_action_rate"     value="10"/>
  <param name="/deploy/local_planner_name" value = "$(arg local_planner)"/>

  <!-- <arg name="scan_topic" default="scan"/> default laser topic in flatland -->
  
 <!-- use simulator and rviz-->
  <include file="$(find arena_bringup)/launch/sublaunch_testing/flatland_simulator.launch">
    <arg name="show_viz"  value="$(arg show_viz)"/>
    <arg name="rviz_file" value="$(arg rviz_file)"/>
  </include>

  <!-- map server-->
  <node name="map_server" pkg="map_server" type="map_server" args="$(arg map_path)">
   <param name="frame_id" value="$(arg global_frame_id)"/>
  </node>

  <include file="$(find arena_bringup)/launch/sublaunch_testing/intermediate_planner.launch">
  </include>
  <!-- use fake localization-->
  <include file="$(find arena_bringup)/launch/sublaunch_testing/fake_localization.launch">
    <arg name="global_frame_id"   value="$(arg global_frame_id)"/>
    <arg name="odom_frame_id"     value="$(arg odom_frame_id)"/>
  </include>

  <!-- start plan manager-->
  <include file="$(find arena_bringup)/launch/sublaunch_testing/plan_manager.launch">
    <arg name="train_mode"        value="false"/>
    <arg name="global_frame_id"   value="$(arg global_frame_id)"/>
    <arg name="odom_frame_id"     value="$(arg odom_frame_id)"/>
    <arg name="base_frame_id"     value="$(arg base_frame_id)"/>
    <arg name="local_planner"     value="$(arg local_planner)"/>
    <!-- 0.3 is robot's velocity 2 is plan zone for waypoint generator -->
    <!-- <arg name="look_ahead_distance"     default="$(eval  2 if arg('local_planner')!='None' else 0.3*2 ) "/>   meter, double -->
    <arg name="look_ahead_distance"     default="2" if="$(eval arg('local_planner') != 'None')"/>
    <arg name="look_ahead_distance"     default="0.6" if="$(eval arg('local_planner') == 'None')"/>    <!-- meter, double-->
    <arg name="tolerance_approach"      default="0.6"/>   <!-- meter, double-->
    <arg name="timeout_goal"     default="330" if="$(eval arg('local_planner') != 'None')"/>
    <arg name="timeout_goal"     default="100" if="$(eval arg('local_planner') == 'None')"/>  
    <arg name="timeout_subgoal"     default="30" if="$(eval arg('local_planner') != 'None')"/>
    <arg name="timeout_subgoal"     default="0.01" if="$(eval arg('local_planner') == 'None')"/>  
  </include>

  
    
</launch>